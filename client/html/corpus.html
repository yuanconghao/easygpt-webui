<!DOCTYPE html>
<html lang="en">
<head>
    {% include "header1.html" %}
    <title>EasyGPT--Corpus</title>
</head>

<body data-urlprefix="{{ url_prefix }}">
<div class="main-container">
    <div class="ui vertical icon menu" style="height:100%; margin-right: 5px;">
        {% include "menu.html" %}
    </div>
    <div class="ui one column stackable grid" style="width: 100%;">
        <div class="sixteen wide column" style="width:100%; margin-left: 20px;">
            <div class="ui form">
                <div class="ui horizontal divider">
                    <font color="#778899">教材语料生成</font>
                </div>
                <div class="inline fields">
                    <a class="ui teal image label">
                        <img src="/easygpt/assets/img/avatar/christian.jpg">
                        Teacher
                        <div class="detail">Role Name</div>
                    </a>
                    <div class="field">
                        <input type="text" size="20" placeholder="Max" name="role_name">
                        <div class="ui left pointing label">
                            You will play my English teacher <em style="color: #d01919;">Max</em>
                        </div>
                        <i class="info circle icon popup_converter" data-content="默认：Max" data-variation="wide"></i>
                    </div>
                </div>

                <div class="inline fields">
                    <label>教学风格：<i class="help circle icon popup_converter"
                                   data-content="Your teaching style is enthusiastic and encouraging, which can reflect your enthusiasm for teaching, stimulate students' interest in learning, provide positive feedback and help to students, and stimulate their learning motivation."
                                   data-variation="wide"></i></label>
                    <div class="field">
                        <div class="ui checkbox">
                            <input checked name="role_style" type="checkbox" value="enthusiastic">
                            <label>热情的<i class="info circle icon popup_converter" data-content="教师对教学充满热情，能够激发学生的学习兴趣。"
                                         data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input name="role_style" type="checkbox" value="strict">
                            <label>严格的<i class="info circle icon popup_converter" data-content="教师对学生的学习要求严格，注重纪律和规则。"
                                         data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input name="role_style" type="checkbox" value="heuristic">
                            <label>启发式的<i class="info circle icon popup_converter"
                                          data-content="教师通过提问、讨论等方式引导学生自我发现和自我学习。" data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input checked name="role_style" type="checkbox" value="encouraging">
                            <label>鼓励式的<i class="info circle icon popup_converter"
                                          data-content="教师对学生的学习给予积极的反馈和鼓励，激发他们的学习动力。"
                                          data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input disabled name="role_style" type="checkbox" value="directive">
                            <label>导向式的<i class="info circle icon popup_converter" data-content="教师主导课堂，提供明确的指导和指示。"
                                          data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input disabled name="role_style" type="checkbox" value="interactive">
                            <label>互动式的<i class="info circle icon popup_converter"
                                          data-content="教师鼓励学生参与课堂讨论，强调师生之间的互动。" data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input disabled name="role_style" type="checkbox" value="discussion">
                            <label>讨论式的<i class="info circle icon popup_converter"
                                          data-content="教师鼓励学生在课堂上提出自己的观点，通过讨论深化理解。" data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input disabled name="role_style" type="checkbox" value="practical">
                            <label>实践式的<i class="info circle icon popup_converter"
                                          data-content="教师注重将理论知识与实际操作相结合，强调学生的实践技能。" data-variation="wide"></i></label>
                        </div>
                    </div>
                </div>

                <div class="inline fields">
                    <label>CEFR Level：<i class="help circle icon popup_converter"
                                         data-content="The English level of the student is at CEFR A1. Please generate 2 talking rounds that the words counts within 20 in each sentence."
                                         data-variation="wide"></i></label>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="cefr_level" type="radio" value="pre-A1">
                            <label>Pre-A1<i class="info circle icon popup_converter" data-content="6岁之前"
                                            data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input checked name="cefr_level" type="radio" value="A1">
                            <label>A1<i class="info circle icon popup_converter" data-content="6-8岁"
                                        data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="cefr_level" type="radio" value="A2">
                            <label>A2<i class="info circle icon popup_converter" data-content="8-10岁"
                                        data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="cefr_level" type="radio" value="B1">
                            <label>B1<i class="info circle icon popup_converter" data-content="10-12岁"
                                        data-variation="wide"></i></label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input disabled name="cefr_level" type="radio" value="B2">
                            <label>B2<i class="info circle icon popup_converter" data-content="12-16岁"
                                        data-variation="wide"></i></label>
                        </div>
                    </div>
                </div>

                <div class="ui divider"></div>

                <div class="inline fields">
                    <label>教学环节：<i class="help circle icon popup_converter" data-content=""
                                   data-variation="wide"></i></label>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="teaching_steps" type="radio" value="vocabulary">
                            <label>词汇学习</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="teaching_steps" type="radio" value="sentence">
                            <label>句子学习</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="teaching_steps" type="radio" value="grammar">
                            <label>语法学习</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input name="teaching_steps" type="radio" value="dialogue">
                            <label>对话学习</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input disabled name="teaching_steps" type="radio" value="game">
                            <label>游戏学习</label>
                        </div>
                    </div>
                </div>

                <div class="ui two column grid">
                    <div class="column">
                        <div class="inline fields">
                            <label>学习Words：</label>
                            <input type="text" placeholder="card|every|father|mother|sometimes|parent"
                                   name="words">
                        </div>
                    </div>
                    <div class="column">
                        <div class="inline fields">
                            <label>学习Sentence：</label>
                            <input type="text" placeholder="Sometimes I give him a card.|I just give him a hug"
                                   name="sentence">
                        </div>
                    </div>
                </div>

                {#                <div class="inline fields">#}
                {#                    <div class="ui labeled input">#}
                {#                        <a class="ui label">#}
                {#                            学习句法#}
                {#                        </a>#}
                {#                        <input type="text" size="100" placeholder="give ... a gift"#}
                {#                               name="sentence">#}
                {#                    </div>#}
                {#                </div>#}
                <div class="ui divider"></div>

                <div class="ui three column grid">
                    <div class="column">
                        <div class="field">
                            <label>教学目标</label>
                            <textarea name="teaching_goal" rows="5"
                                      placeholder="The dialogue goal includes introducing the game to student. Ask the student move the magnifying glass to see the toys in the claw machine. Then tell you what kind of toys are in the machine."></textarea>
                        </div>
                    </div>
                    <div class="column">
                        <div class="field">
                            <label>教材背景描述</label>
                            <textarea name="teaching_background" rows="5"
                                      placeholder="there are a claw machine that takes up the entire screen. There’s a cat, a truck, a bird, a teddy bear, a pink doll and a green monster in the claw machine. The student just can see part of the background image with the magnifying glass tool, but not all. Student can move the magnifying glass tool to see the entire background image."></textarea>
                        </div>
                    </div>

                    <div class="column">
                        <div class="field">
                            <label>教材角色描述</label>
                            <textarea name="teaching_characters" rows="5"
                                      placeholder="A boy name Timmy and a girl name Cindy are standing in the center of the toy store. Timmy is holding a green one-eyed plush monster puppet, and Cindy is holding a pink doll."></textarea>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="field">
                        <label>一轮对话示例</label>
                        <textarea name="teaching_example" rows="4"
                                  placeholder="Teacher:  Hello there, dear! Welcome to AI Class. My name is Max and I am your friendly English teacher. We're going to have a lot of fun learning together! Can you say, 'Hello, Max!'?
Student:  Hello, Max.
Teacher:  Very good! I'm really happy to hear you speaking English! Now, can you tell me, how are you today?
Student:  I’m happy.
Teacher:  Excellent! I'm glad to hear you're fine. Now let's start our English journey together, shall we?
Student:  Okay!"></textarea>
                    </div>
                </div>

                <div class="ui divider"></div>
                <div class="ui grid">
                    <div class="two wide column">
                        <div class="inline fields">
                            <label>生成数量</label>
                            <div class="ui selection dropdown corpus_nums" style="min-width: 5em;">
                                <input name="corpus_nums" type="hidden" value="1">
                                <i class="dropdown icon"></i>
                                <div class="default text">1</div>
                                <div class="menu">
                                    <div class="item" data-value="1">1</div>
                                    <div class="item" data-value="2">2</div>
                                    <div class="item" data-value="3">3</div>
                                    <div class="item" data-value="4">4</div>
                                    <div class="item" data-value="5">5</div>
                                    <div class="item" data-value="6">6</div>
                                    <div class="item" data-value="7">7</div>
                                    <div class="item" data-value="8">8</div>
                                    <div class="item" data-value="9">9</div>
                                    <div class="item" data-value="10">10</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="three wide column">
                        <div class="inline fields">
                            <label>生成格式</label>
                            <div class="ui selection dropdown corpus_format" style="min-width: 8em;">
                                <input name="corpus_format" type="hidden" value="openai">
                                <i class="dropdown icon"></i>
                                <div class="default text">Openai</div>
                                <div class="menu">
                                    <div class="item" data-value="openai">Openai</div>
                                    <div class="item" data-value="qianfan">百度千帆</div>
                                    <div class="item disabled" data-value="llama2">LLama2</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="five wide column" style="display: flex; justify-content: left; align-items: center;">
                        <div class="inline fields">
                            <label>语料能力：</label>
                            <div class="field">
                                <div class="ui checkbox">
                                    <input name="corpus_func" type="checkbox" value="pull">
                                    <label>拉会</label>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui checkbox">
                                    <input name="corpus_func" type="checkbox" value="correction">
                                    <label>纠错</label>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui checkbox">
                                    <input name="corpus_func" type="checkbox" value="explain">
                                    <label>解释</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="three wide column" style="display: flex; justify-content: left; align-items: center;">
                        <div class="inline fields">
                            <a class="corpus_download" href="#" download></a>
                        </div>
                    </div>
                    <div class="three wide right aligned column">
                        <button class="ui primary button generate_corpus">
                            语料生成
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- scripts -->
<script>
    const url_prefix = document.querySelector("body").getAttribute("data-urlprefix");
    $(function () {

        //popup
        $('.popup_converter').popup();

        $('.ui.dropdown.corpus_nums').dropdown();

        $('.ui.dropdown.corpus_format').dropdown();

        // 生成
        $(".generate_corpus").click(
            function () {
                var role_name = $("input[name=role_name]").val();
                if (role_name == "") {
                    role_name = "Max"
                }
                console.log(role_name)
                var role_style = [];
                $('input[name="role_style"]:checked').each(function () {
                    role_style.push($(this).val());
                });
                console.log(role_style)
                var cefr_level = $('input[name="cefr_level"]:checked').val();
                console.log(cefr_level)
                var teaching_steps = $('input[name="teaching_steps"]:checked').val();
                console.log(teaching_steps)
                if (teaching_steps == null) {
                    alert("教学环节不能为空！");
                    return;
                }
                var words = $("input[name=words]").val();
                console.log(words)
                if (teaching_steps == "step_vocab" && words == "") {
                    alert("教学环节：词汇学习，学习Words不能为空！");
                    return;
                }
                var sentence = $("input[name=sentence]").val();
                console.log(sentence)
                if (teaching_steps == "step_sentence" && sentence == "") {
                    alert("教学环节：句子学习，学习Sentence不能为空！");
                    return;
                }
                var teaching_goal = $("textarea[name=teaching_goal]").val();
                console.log(teaching_goal)
                var teaching_background = $("textarea[name=teaching_background]").val();
                console.log(teaching_background)
                var teaching_characters = $("textarea[name=teaching_characters]").val();
                console.log(teaching_characters)
                var teaching_example = $("textarea[name=teaching_example]").val();
                console.log(teaching_example)
                var corpus_nums = $("input[name=corpus_nums]").val();
                console.log(corpus_nums)
                var corpus_format = $("input[name=corpus_format]").val();
                console.log(corpus_format)
                var corpus_func = [];
                $('input[name="corpus_func"]:checked').each(function () {
                    corpus_func.push($(this).val());
                });
                console.log(corpus_func);
                var startTime = new Date();

                params = {
                    role_name: role_name,
                    role_style: role_style,
                    cefr_level: cefr_level,
                    teaching_steps: teaching_steps,
                    words: words,
                    sentence: sentence,
                    teaching_goal: teaching_goal,
                    teaching_background: teaching_background,
                    teaching_characters: teaching_characters,
                    teaching_example: teaching_example,
                    corpus_nums: corpus_nums,
                    corpus_format: corpus_format,
                    corpus_func: corpus_func
                };
                $(".generate_corpus").addClass('loading');
                $.ajax({
                    url: `${url_prefix}/backend-api/v2/generate_corpus`,
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(params),
                    processData: false,
                    xhrFields: {
                        {#responseType: 'blob'#}
                    },
                    success: function (data) {
                        var endTime = new Date();
                        var timeDiff = endTime - startTime; // in ms
                        timeDiff /= 1000;
                        var seconds = Math.round(timeDiff);
                        console.log("jjjjjjjjjjjjjjjjjjjjj");
                        console.log(data)
                        console.log("time cost:" + seconds);
                        {#var new_url = URL.createObjectURL(data);#}
                        {#console.log(new_url);#}
                        new_url = `${url_prefix}/outputs/corpus/` + data
                        $('.corpus_download').attr('href', new_url);
                        $('.corpus_download').append(data);
                        alert("生成完成，请下载");
                        $(".generate_corpus").removeClass('loading');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error("AJAX request failed: ", textStatus, errorThrown);
                        info = "request failed";
                        alert(info);
                        $(".generate_corpus").removeClass('loading');
                    }
                });
            });
    });
</script>
</body>
</html>
